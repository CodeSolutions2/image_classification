<!DOCTYPE html>
<html>
<head></head>
<body>
  
    <!-- <img id="img" src="https://storage.googleapis.com/images4download0/image2.png" style="display:block" width="224" height="224" /> -->
    <!-- <img id="img" src="apple.png" style="display:block" width="224" height="224" /> -->
    <!-- OR -->
    <!-- Makes a selection file reader from the PC only, not from the cloud -->
    <!-- <input type="file" id="img_input" name="avatar" accept="image/png, image/jpeg"> -->


    <button id="myBtn" onclick="run_mobilenet()">Run Selection</button>

    <div id="output" style="font-family:courier;font-size:24px;height:300px"></div>

    <textarea id="outData" rows="2" cols="70" placeholder="notification" style="display:block"></textarea>


<script src="https://cdn.jsdelivr.net/npm/@tensorflow/tfjs@latest"> </script>
<script src="https://cdn.jsdelivr.net/npm/@tensorflow-models/mobilenet@1.0.0"> </script> 

  
<script>
  
  const outp = document.getElementById('output');

  // -------------------------------------------------

  async function run_mobilenet() {

    var IMAGE_SIZE = 224;
    
    // ----------------------

    try {
      
      const image = new Image();

      // image.src = "https://storage.googleapis.com/images4download0/image2.png";
      image.src = "apple.png";
      // image.src = "tomatoe.png";
      
      image.onload = function (){
        // Convert the image element to a tensor using fromPixels
        var tensor_image = tf.browser.fromPixels(image); // This is size 224,224,3
        document.getElementById("outData").innerHTML = tf.max(tensor_image);
        const eTensor = tensor_image.expandDims(0); // This is size 1,224,224,3
        // Give image to model
        mobilenet.load().then(model => {model.classify(eTensor).then(predictions => {for(var i = 0; i<predictions.length; i++){outp.innerHTML += "<br/>" + predictions[i].className + " : " + predictions[i].probability;} }); });
      };
    

    } catch (error) {
      document.getElementById("outData").innerHTML = error; 
      // return error
    }
    
  }  // end of load_image
  
  // -------------------------------------------------


  function train_a_model(){

    const model = tf.sequential();

    //create the first layer 
    model.add(tf.layers.conv2d({
      inputShape: [28, 224, 1],
      kernelSize: 5,
      filters: 8,
      strides: 1,
      activation: 'relu',
      kernelInitializer: 'VarianceScaling'
    }));

    //create a max pooling layer 
    model.add(tf.layers.maxPooling2d({
      poolSize: [2, 2],
      strides: [2, 2]
    }));

    //create the second conv layer
    model.add(tf.layers.conv2d({
      kernelSize: 5,
      filters: 16,
      strides: 1,
      activation: 'relu',
      kernelInitializer: 'VarianceScaling'
    }));

    //create a max pooling layer 
    model.add(tf.layers.maxPooling2d({poolSize: [2, 2], strides: [2, 2]}));

    //flatten the layers to use it for the dense layers 
    model.add(tf.layers.flatten());

    //dense layer with output 10 units 
    model.add(tf.layers.dense({
      units: 2,
      kernelInitializer: 'VarianceScaling',
      activation: 'softmax'
    }));

    const LEARNING_RATE = 0.0001;
    const optimizer = tf.train.adam(LEARNING_RATE);

    model.compile({
      optimizer: optimizer,
      loss: 'categoricalCrossentropy',
      metrics: ['accuracy'],
    });

    const batch = tf.zeros([BATCH_SIZE,28,28,1]);
    const labels = tf.zeros([BATCH_SIZE, NUM_CLASSES]);

    const h = await model.fit(batch, labels,
                {
                  batchSize: BATCH_SIZE,
                  validationData: validationData,
                  epochs: BATCH_EPOCHs
                });

  }




</script>
</body>
</html>
